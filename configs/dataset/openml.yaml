defaults: # fixme: override base.yaml defaults wrt dataset - dataset/lcbench!
  - dataset_meta: lcbench_minimal
  - lc_meta: multi_slice
  - algo_meta: NULL

name: openml

path:
  algo_meta: ${dir_data_processed}/${dataset.name} #/config_subset.csv
  data_meta: ${dir_data_processed}/${dataset.name}/dataset_meta_features.csv
  lc_meta: ${dir_data_processed}/${dataset.name}/average_test_accuracy_lcs.h5


slices: [ 0.05,  0.1, 0.15,  0.2, 0.25,  0.3, 0.35, 0.4, 0.45,  0.5, 0.55, 0.6, 0.65,  0.7, 0.75,  0.8, 0.85,  0.9, 0.95, 1.0 ]

train_dataset_class: # -----------------------------------------------------------------------------
  _target_: imfas.data.Dataset_Join_Dmajor
  meta_dataset: ${dataset.dataset_meta}
  #  meta_algo: ${dataset.algo_meta}
  learning_curves: # ${dataset.lc_meta}
    # FIXME: move this back to lc_meta (but make metric accessible from here!
    _target_: imfas.data.Dataset_LC
    path: ${dataset.path.lc_meta}

    transforms:
      _target_: imfas.data.preprocessings.transformpipeline.TransformPipeline
      modulelist:
        - _target_: imfas.data.preprocessings.table_transforms.Convert
        - _target_: imfas.data.preprocessings.lc_slice.LC_TimeSlices
          slices: ${dataset.slices}


valid_dataset_class: # -----------------------------------------------------------------------------
  _target_: imfas.data.Dataset_Join_Dmajor
  meta_dataset: ${dataset.dataset_meta}
  #  meta_algo: ${dataset.algo_meta}
  learning_curves: # ${dataset.lc_meta}
    # FIXME: move this back to lc_meta (but make metric accessible from here!
    _target_: imfas.data.Dataset_LC
    path: ${dataset.path.lc_meta}

    transforms:
      _target_: imfas.data.preprocessings.transformpipeline.TransformPipeline
      modulelist:
        - _target_: imfas.data.preprocessings.table_transforms.Convert
        - _target_: imfas.data.preprocessings.lc_slice.LC_TimeSlices
          slices: ${dataset.slices}

test_dataset_class: # -----------------------------------------------------------------------------
  _target_: imfas.data.Dataset_Join_Dmajor
  meta_dataset: ${dataset.dataset_meta}
  #  meta_algo: ${dataset.algo_meta}
  learning_curves: # ${dataset.lc_meta}
    # FIXME: move this back to lc_meta (but make metric accessible from here!
    _target_: imfas.data.Dataset_LC
    path: ${dataset.path.lc_meta}

    transforms:
      _target_: imfas.data.preprocessings.transformpipeline.TransformPipeline
      modulelist:
        - _target_: imfas.data.preprocessings.table_transforms.Convert
        - _target_: imfas.data.preprocessings.lc_slice.LC_TimeSlices
          slices: ${dataset.slices}


# Dataloaders ------------------------------------------------------------------------------------
train_dataloader_class:
  _target_: torch.utils.data.DataLoader
  batch_size: 5  # introduce randomness for iterative algos
  shuffle: True
  num_workers: ${num_workers}

valid_dataloader_class:
  _target_: torch.utils.data.DataLoader
  batch_size: ${dynamically_computed.n_datasets} # average over validation datasets in one go
  shuffle: True
  num_workers: ${num_workers}

test_dataloader_class:
  _target_: torch.utils.data.DataLoader
  batch_size: ${dynamically_computed.n_datasets} # average over test datasets in one go
  shuffle: False
  num_workers: ${num_workers}


# (Raw Dataset choices) ----------------------------------------------------------------------------


# fixme: look at multi-slice behaviour


dataset_raw:
  _target_: imfas.data.openml.raw_pipe.raw_pipe
  enable: False # whether to override the preprocessing

  cols:
    - test_accuracy_fold_1
    - test_accuracy_fold_2
    - test_accuracy_fold_3
    - average_test_accuracy
