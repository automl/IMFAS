# @package _global_

# run this file with
# python mf_gravitas/main.py +experiment=search_spaces/ssp_rank_ensemble --multirun


# Be carefull: when writing a new search space: it has to be a global package (and on top of the
#  file),
# which move the file one up in the tree - so it is no longer experiment/smac_mf
defaults:
  - smac_mf # important back reference for the original smac sweeper config
  - override /training: freeze_ensemble


# smac parameter defaults:

## change relative data dir due to hydra_smac_sweeper
dataset_raw:
  dir_data: ../../../data/
dataset:
  preprocessed_path: ../../../data/raw/${dataset.name}

  slices: [ 15, 30, 40, 51 ]

model:
  n_fidelities: 4  # fixme: the length should automatically adjusted to dataset.slices!
  join: wavg
  shared_hidden_dims:
    - 200
    - 200
  fc_dim:
    - 58 # explicit fixture

training:
  epochs:
    - 200 # pretraining I (multihead-only)
    - 0  # pretraining II (final-head-only)
    - 10000 # full training budget (will be overridden by sweeper)

lr: 0.001


wandb:
  group: smac_rankmlp_freeze
  notes: 'Running the freeze training procedure for optimizing the multiheads and determine AVG vs WAVG'
  mode: 'offline'

hydra:
  sweeper:

    budget_variable: training.epochs.2
    search_space:
      hyperparameters:
        model.shared_hidden_dims.0:
          type: uniform_int
          lower: 100
          upper: 400
          log: true
          default: ${model.shared_hidden_dims.0}
        model.shared_hidden_dims.1:
          type: uniform_int
          lower: 100
          upper: 400
          log: true
          default: ${model.shared_hidden_dims.1}
        model.multi_head_dims:
          type: uniform_int
          lower: 100
          upper: 400
          log: true
          default: ${model.multi_head_dims.0}
        #        model.fc_dim.0:
        #          type: uniform_int
        #          lower: 20
        #          upper: 400
        #          log: true
        #          default: ${model.fc_dim.0}
        #        model.join:
        #          type: categorical
        #          choices: [ avg, wavg ]
        #          default_value: ${model.join}
        lr: # currently top level ( base ) variable
          type: uniform_float
          lower: 0.0001
          upper: 0.1
          default_value: ${lr}
          log: true
